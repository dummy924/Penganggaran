<!DOCTYPE html>
<html lang="id">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Dasbor Penganggaran Cerdas</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <!-- SheetJS (xlsx.js) untuk membaca/menulis Excel (.xlsx) -->
    <script src="https://unpkg.com/xlsx/dist/xlsx.full.min.js"></script>
    <!-- Chart.js untuk grafik -->
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap" rel="stylesheet">
    <style>
        body {
            font-family: 'Inter', sans-serif;
            background-color: #f1f5f9;
        }
        /* Custom scrollbar styling */
        .custom-scrollbar::-webkit-scrollbar {
            width: 8px;
        }
        .custom-scrollbar::-webkit-scrollbar-track {
            background: #f1f5f9;
            border-radius: 10px;
        }
        .custom-scrollbar::-webkit-scrollbar-thumb {
            background: #94a3b8;
            border-radius: 10px;
        }
        .custom-scrollbar::-webkit-scrollbar-thumb:hover {
            background: #64748b;
        }
        .chart-container {
            position: relative;
            height: 300px;
            width: 100%;
        }
    </style>
</head>
<body class="bg-slate-100">

    <div class="container mx-auto p-4 sm:p-6 lg:p-8">
        
        <header class="mb-6">
            <h1 class="text-3xl sm:text-4xl font-bold text-slate-800">Dasbor Penganggaran Cerdas</h1>
            <p id="userIdDisplay" class="text-sm text-slate-500 mt-1" title="User ID"></p>
        </header>

        <!-- Bagian Dasbor Analisis -->
        <section id="dashboard" class="grid grid-cols-1 lg:grid-cols-3 gap-6 mb-6">
            <!-- Kartu Saldo Utama -->
            <div class="bg-white p-6 rounded-2xl shadow-lg border border-slate-200 col-span-1 lg:col-span-3">
                 <h2 class="text-lg font-semibold text-slate-600 mb-2">Total Saldo Saat Ini</h2>
                 <p id="currentBalance" class="text-4xl sm:text-5xl font-bold text-blue-600">Rp 0</p>
            </div>
            
            <!-- Kartu Analisis Bulanan -->
            <div class="bg-white p-6 rounded-2xl shadow-lg border border-slate-200">
                <h3 class="text-md font-semibold text-slate-600 mb-4">Analisis Bulan Ini</h3>
                <div class="space-y-4">
                    <div>
                        <p class="text-sm text-slate-500">Total Pemasukan</p>
                        <p id="monthlyIncome" class="text-2xl font-bold text-green-600">Rp 0</p>
                    </div>
                    <div>
                        <p class="text-sm text-slate-500">Total Pengeluaran</p>
                        <p id="monthlyExpense" class="text-2xl font-bold text-red-600">Rp 0</p>
                    </div>
                </div>
            </div>

            <!-- Kartu Rasio & Kategori -->
            <div class="bg-white p-6 rounded-2xl shadow-lg border border-slate-200">
                 <h3 class="text-md font-semibold text-slate-600 mb-4">Rasio & Kategori Bulan Ini</h3>
                 <div class="space-y-4">
                    <div>
                        <p class="text-sm text-slate-500">Rasio Tabungan (Savings Rate)</p>
                        <p id="savingsRate" class="text-2xl font-bold text-indigo-600">0%</p>
                    </div>
                    <div>
                        <p class="text-sm text-slate-500">Pengeluaran Wajib vs. Keinginan</p>
                        <div class="w-full bg-gray-200 rounded-full h-4 mt-1">
                          <div id="needsWantsBar" class="bg-gradient-to-r from-sky-500 to-indigo-500 h-4 rounded-full" style="width: 0%"></div>
                        </div>
                        <div class="text-xs flex justify-between mt-1">
                            <span id="needsPercentage" class="font-semibold text-sky-600">Wajib: 0%</span>
                            <span id="wantsPercentage" class="font-semibold text-indigo-600">Keinginan: 0%</span>
                        </div>
                    </div>
                 </div>
            </div>

            <!-- Grafik Pengeluaran -->
            <div class="bg-white p-6 rounded-2xl shadow-lg border border-slate-200">
                <h3 class="text-md font-semibold text-slate-600 mb-4">Komposisi Pengeluaran Bulan Ini</h3>
                <div class="chart-container">
                    <canvas id="expensePieChart"></canvas>
                </div>
            </div>
        </section>

        <!-- Bagian Manajemen Transaksi -->
        <section id="transaction-management" class="bg-white p-6 rounded-2xl shadow-lg border border-slate-200">
            <div class="flex flex-col sm:flex-row justify-between items-start sm:items-center mb-4">
                <h2 class="text-2xl font-bold text-slate-800 mb-2 sm:mb-0">Histori Transaksi</h2>
                <div class="flex items-center gap-2 w-full sm:w-auto">
                    <button id="exportBudgetButton" class="w-full sm:w-auto bg-blue-600 hover:bg-blue-700 text-white font-semibold py-2 px-4 rounded-lg shadow-md transition-transform transform hover:scale-105 active:scale-95 text-sm">
                        Export ke Excel
                    </button>
                    <button id="addTransactionButton" class="w-full sm:w-auto bg-green-600 hover:bg-green-700 text-white font-semibold py-2 px-4 rounded-lg shadow-md transition-transform transform hover:scale-105 active:scale-95 text-sm">
                        Tambah Transaksi
                    </button>
                </div>
            </div>
            
            <!-- Kontrol Transaksi -->
            <div class="mb-4">
                 <input
                    type="text"
                    id="transactionSearchInput"
                    placeholder="Cari transaksi..."
                    class="w-full p-3 border border-gray-300 rounded-lg text-gray-700 focus:ring-2 focus:ring-blue-500 focus:border-blue-500 transition"
                    aria-label="Cari transaksi"
                >
            </div>

            <!-- Daftar Transaksi -->
            <div class="overflow-x-auto">
                 <table class="min-w-full divide-y divide-gray-200">
                    <thead class="bg-gray-50">
                        <tr>
                            <th scope="col" class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Deskripsi</th>
                            <th scope="col" class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Jumlah</th>
                            <th scope="col" class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Kategori</th>
                            <th scope="col" class="px-6 py-3 text-right text-xs font-medium text-gray-500 uppercase tracking-wider">Aksi</th>
                        </tr>
                    </thead>
                    <tbody id="transactionList" class="bg-white divide-y divide-gray-200">
                        <!-- Items will be rendered here -->
                    </tbody>
                </table>
                 <p id="noTransactionsMessage" class="text-gray-500 text-center mt-8 hidden">Belum ada transaksi. Silakan tambahkan satu!</p>
            </div>
        </section>

    </div>

    <!-- Modal Tambah/Edit Transaksi -->
    <div id="addEditTransactionModal" class="fixed inset-0 bg-gray-900 bg-opacity-75 flex items-center justify-center hidden z-50">
        <div class="bg-white p-8 rounded-xl shadow-2xl w-full max-w-md mx-4">
            <h3 id="transactionModalTitle" class="text-2xl font-bold text-gray-800 mb-6">Tambah Transaksi</h3>
            <form id="transactionForm" class="space-y-4">
                <select id="transactionTypeInput" name="transactionTypeInput" class="w-full p-3 border border-gray-300 rounded-lg text-gray-700 focus:ring-2 focus:ring-blue-500">
                    <option value="expense">Pengeluaran</option>
                    <option value="income">Pemasukan</option>
                </select>
                <input type="number" id="transactionAmountInput" name="transactionAmountInput" placeholder="Jumlah (Rp)" class="w-full p-3 border border-gray-300 rounded-lg text-gray-700 focus:ring-2 focus:ring-blue-500" min="0">
                <input type="text" id="transactionDescriptionInput" name="transactionDescriptionInput" placeholder="Deskripsi (misal: Gaji, Belanja Makanan)" class="w-full p-3 border border-gray-300 rounded-lg text-gray-700 focus:ring-2 focus:ring-blue-500">
                <input type="date" id="transactionDateInput" name="transactionDateInput" class="w-full p-3 border border-gray-300 rounded-lg text-gray-700 focus:ring-2 focus:ring-blue-500">
                
                <div id="categoryContainer">
                    <label for="transactionCategoryInput" class="text-sm font-medium text-gray-700">Kategori Pengeluaran</label>
                    <select id="transactionCategoryInput" name="transactionCategoryInput" class="w-full p-3 border border-gray-300 rounded-lg text-gray-700 focus:ring-2 focus:ring-blue-500 mt-1">
                        <option value="wajib">Wajib (Kebutuhan)</option>
                        <option value="keinginan">Keinginan (Gaya Hidup)</option>
                    </select>
                </div>
                 <div class="flex justify-end space-x-4 pt-4">
                    <button type="button" id="cancelTransactionButton" class="bg-gray-200 hover:bg-gray-300 text-gray-800 font-semibold py-2 px-4 rounded-lg transition">Batal</button>
                    <button type="submit" class="bg-blue-600 hover:bg-blue-700 text-white font-semibold py-2 px-4 rounded-lg transition">Simpan</button>
                </div>
            </form>
        </div>
    </div>
    
    <!-- Modal Export -->
    <div id="exportBudgetModal" class="fixed inset-0 bg-gray-900 bg-opacity-75 flex items-center justify-center hidden z-50">
        <div class="bg-white p-8 rounded-xl shadow-2xl w-full max-w-md mx-4">
            <h3 class="text-2xl font-bold text-gray-800 mb-6">Pilih Rentang Tanggal Ekspor</h3>
            <div class="space-y-4">
                <div>
                    <label for="exportStartDateInput" class="block text-sm font-medium text-gray-700">Tanggal Mulai:</label>
                    <input type="date" id="exportStartDateInput" class="w-full p-3 border border-gray-300 rounded-lg text-gray-700 mt-1">
                </div>
                <div>
                    <label for="exportEndDateInput" class="block text-sm font-medium text-gray-700">Tanggal Akhir:</label>
                    <input type="date" id="exportEndDateInput" class="w-full p-3 border border-gray-300 rounded-lg text-gray-700 mt-1">
                </div>
            </div>
            <div class="flex justify-end space-x-4 mt-8">
                <button type="button" id="cancelExportButton" class="bg-gray-200 hover:bg-gray-300 text-gray-800 font-semibold py-2 px-4 rounded-lg">Batal</button>
                <button type="button" id="confirmExportButton" class="bg-blue-600 hover:bg-blue-700 text-white font-semibold py-2 px-4 rounded-lg">Ekspor</button>
            </div>
        </div>
    </div>
    
    <!-- Message Box -->
    <div id="messageBox" class="fixed bottom-5 right-5 bg-red-600 text-white py-3 px-5 rounded-lg shadow-lg text-center opacity-0 transition-all duration-300 pointer-events-none z-[100]"></div>

    <script type="module">
        // --- Global Variables & State ---
        let budgetTransactions = [];
        let editingTransactionId = null;
        let expenseChart = null; // To hold the chart instance

        let sessionId = localStorage.getItem('budgetSessionId');
        if (!sessionId) {
            sessionId = crypto.randomUUID();
            localStorage.setItem('budgetSessionId', sessionId);
        }

        // --- DOM Element References ---
        const currentBalance = document.getElementById('currentBalance');
        const monthlyIncome = document.getElementById('monthlyIncome');
        const monthlyExpense = document.getElementById('monthlyExpense');
        const savingsRate = document.getElementById('savingsRate');
        const needsWantsBar = document.getElementById('needsWantsBar');
        const needsPercentage = document.getElementById('needsPercentage');
        const wantsPercentage = document.getElementById('wantsPercentage');
        const addTransactionButton = document.getElementById('addTransactionButton');
        const transactionList = document.getElementById('transactionList');
        const noTransactionsMessage = document.getElementById('noTransactionsMessage');
        const transactionSearchInput = document.getElementById('transactionSearchInput');
        const userIdDisplay = document.getElementById('userIdDisplay');
        userIdDisplay.textContent = `ID Sesi Lokal: ${sessionId.substring(0, 8)}`;
        
        // Modals
        const addEditTransactionModal = document.getElementById('addEditTransactionModal');
        const transactionModalTitle = document.getElementById('transactionModalTitle');
        const transactionForm = document.getElementById('transactionForm');
        const transactionTypeInput = document.getElementById('transactionTypeInput');
        const transactionAmountInput = document.getElementById('transactionAmountInput');
        const transactionDescriptionInput = document.getElementById('transactionDescriptionInput');
        const transactionDateInput = document.getElementById('transactionDateInput');
        const categoryContainer = document.getElementById('categoryContainer');
        const transactionCategoryInput = document.getElementById('transactionCategoryInput');
        const cancelTransactionButton = document.getElementById('cancelTransactionButton');
        
        // Export elements
        const exportBudgetButton = document.getElementById('exportBudgetButton');
        const exportBudgetModal = document.getElementById('exportBudgetModal');
        const exportStartDateInput = document.getElementById('exportStartDateInput');
        const exportEndDateInput = document.getElementById('exportEndDateInput');
        const cancelExportButton = document.getElementById('cancelExportButton');
        const confirmExportButton = document.getElementById('confirmExportButton');

        const messageBox = document.getElementById('messageBox');

        // --- Utility Functions ---
        function showMessage(message, type = 'error') {
            messageBox.textContent = message;
            messageBox.className = 'fixed bottom-5 right-5 text-white py-3 px-5 rounded-lg shadow-lg text-center transition-all duration-300 pointer-events-none z-[100]';
            messageBox.classList.add(type === 'success' ? 'bg-green-600' : 'bg-red-600');
            messageBox.classList.remove('opacity-0');
            setTimeout(() => messageBox.classList.add('opacity-0'), 3000);
        }

        const formatRupiah = (amount) => new Intl.NumberFormat('id-ID', { style: 'currency', currency: 'IDR', minimumFractionDigits: 0 }).format(amount);
        const formatDateToYYYYMMDD = (dateObj) => dateObj.toISOString().split('T')[0];

        const loadTransactions = () => {
            const data = localStorage.getItem(`budgetTransactions_${sessionId}`);
            budgetTransactions = data ? JSON.parse(data) : [];
            renderUI();
        };
        const saveTransactions = () => localStorage.setItem(`budgetTransactions_${sessionId}`, JSON.stringify(budgetTransactions));

        // --- Core UI Rendering & Calculation ---
        function renderUI() {
            renderDashboard();
            renderTransactionList();
        }

        function renderDashboard() {
            const totalBalance = budgetTransactions.reduce((total, t) => t.type === 'income' ? total + t.amount : total - t.amount, 0);
            currentBalance.textContent = formatRupiah(totalBalance);
            const now = new Date();
            const startOfMonth = new Date(now.getFullYear(), now.getMonth(), 1);
            const endOfMonth = new Date(now.getFullYear(), now.getMonth() + 1, 0);
            const monthlyTransactions = budgetTransactions.filter(t => {
                const tDate = new Date(t.date);
                return tDate >= startOfMonth && tDate <= endOfMonth;
            });
            const incomeThisMonth = monthlyTransactions.filter(t => t.type === 'income').reduce((sum, t) => sum + t.amount, 0);
            const expenseThisMonth = monthlyTransactions.filter(t => t.type === 'expense').reduce((sum, t) => sum + t.amount, 0);
            monthlyIncome.textContent = formatRupiah(incomeThisMonth);
            monthlyExpense.textContent = formatRupiah(expenseThisMonth);
            const rate = incomeThisMonth > 0 ? ((incomeThisMonth - expenseThisMonth) / incomeThisMonth) * 100 : 0;
            savingsRate.textContent = `${Math.round(rate)}%`;
            const needsExpense = monthlyTransactions.filter(t => t.type === 'expense' && t.category === 'wajib').reduce((sum, t) => sum + t.amount, 0);
            const wantsExpense = monthlyTransactions.filter(t => t.type === 'expense' && t.category === 'keinginan').reduce((sum, t) => sum + t.amount, 0);
            const totalExpenseCategory = needsExpense + wantsExpense;
            const needsPerc = totalExpenseCategory > 0 ? (needsExpense / totalExpenseCategory) * 100 : 0;
            const wantsPerc = totalExpenseCategory > 0 ? (wantsExpense / totalExpenseCategory) * 100 : 0;
            needsWantsBar.style.width = `${needsPerc}%`;
            needsPercentage.textContent = `Wajib: ${Math.round(needsPerc)}%`;
            wantsPercentage.textContent = `Keinginan: ${Math.round(wantsPerc)}%`;
            renderExpensePieChart(monthlyTransactions);
        }

        function renderExpensePieChart(transactions) {
            const ctx = document.getElementById('expensePieChart').getContext('2d');
            const expenseData = transactions
                .filter(t => t.type === 'expense')
                .reduce((acc, t) => {
                    const desc = t.description.toLowerCase();
                    acc[desc] = (acc[desc] || 0) + t.amount;
                    return acc;
                }, {});

            const labels = Object.keys(expenseData);
            const data = Object.values(expenseData);
            const backgroundColors = labels.map((_, i) => `hsl(${i * 40}, 70%, 60%)`);

            if (expenseChart) expenseChart.destroy();
            if (labels.length === 0) return;
            
            expenseChart = new Chart(ctx, {
                type: 'doughnut',
                data: {
                    labels: labels.map(l => l.charAt(0).toUpperCase() + l.slice(1)),
                    datasets: [{ label: 'Pengeluaran', data: data, backgroundColor: backgroundColors, borderColor: '#ffffff', borderWidth: 2 }]
                },
                options: {
                    responsive: true, maintainAspectRatio: false,
                    plugins: {
                        legend: { position: 'bottom', labels: { font: { size: 10 } } },
                        tooltip: { callbacks: { label: (context) => `${context.label || ''}: ${formatRupiah(context.parsed)}` } }
                    }
                }
            });
        }
        
        function renderTransactionList() {
            transactionList.innerHTML = '';
            const searchTerm = transactionSearchInput.value.toLowerCase();
            const filtered = budgetTransactions.filter(t => t.description.toLowerCase().includes(searchTerm)).sort((a, b) => new Date(b.date) - new Date(a.date));
            if (filtered.length === 0) {
                noTransactionsMessage.classList.remove('hidden');
            } else {
                noTransactionsMessage.classList.add('hidden');
                filtered.forEach(t => transactionList.appendChild(createTransactionElement(t)));
            }
        }
        
        function createTransactionElement(transaction) {
            const tr = document.createElement('tr');
            tr.className = 'hover:bg-gray-50';
            const typeClass = transaction.type === 'income' ? 'text-green-600' : 'text-red-600';
            const sign = transaction.type === 'income' ? '+' : '-';
            let categoryText = '-';
            let categoryClass = 'text-gray-500';
            if (transaction.type === 'expense') {
                if (transaction.category === 'wajib') { categoryText = 'Wajib'; categoryClass = 'bg-sky-100 text-sky-700'; } 
                else if (transaction.category === 'keinginan') { categoryText = 'Keinginan'; categoryClass = 'bg-indigo-100 text-indigo-700'; }
            }
            tr.innerHTML = `
                <td class="px-6 py-4 whitespace-nowrap"><div class="text-sm font-medium text-gray-900">${transaction.description}</div><div class="text-sm text-gray-500">${new Date(transaction.date).toLocaleDateString('id-ID', { day: 'numeric', month: 'long', year: 'numeric'})}</div></td>
                <td class="px-6 py-4 whitespace-nowrap text-sm font-semibold ${typeClass}">${sign} ${formatRupiah(transaction.amount)}</td>
                <td class="px-6 py-4 whitespace-nowrap text-sm">${categoryText !== '-' ? `<span class="px-2 inline-flex text-xs leading-5 font-semibold rounded-full ${categoryClass}">${categoryText}</span>` : '-'}</td>
                <td class="px-6 py-4 whitespace-nowrap text-right text-sm font-medium"><button class="edit-btn text-indigo-600 hover:text-indigo-900 mr-3" data-id="${transaction.id}">Edit</button><button class="delete-btn text-red-600 hover:text-red-900" data-id="${transaction.id}">Hapus</button></td>`;
            return tr;
        }

        // --- Transaction Logic ---
        function saveTransaction(data) {
            const { id, type, amount, description, date, category } = data;
            if (isNaN(amount) || amount <= 0 || !description || !date) {
                showMessage('Harap isi semua kolom dengan benar.', 'error'); return;
            }
            if (id) {
                const index = budgetTransactions.findIndex(t => t.id === id);
                budgetTransactions[index] = { ...budgetTransactions[index], type, amount, description, date, category: type === 'expense' ? category : null };
                showMessage('Transaksi berhasil diperbarui.', 'success');
            } else {
                budgetTransactions.push({ id: crypto.randomUUID(), type, amount, description, date, category: type === 'expense' ? category : null });
                showMessage('Transaksi berhasil ditambahkan.', 'success');
            }
            saveTransactions(); renderUI(); hideModals();
        }
        
        function deleteTransaction(id) {
            budgetTransactions = budgetTransactions.filter(t => t.id !== id);
            saveTransactions(); renderUI();
            showMessage('Transaksi berhasil dihapus.', 'success');
        }

        // --- Modal Handling ---
        function showAddEditTransactionModal(id = null) {
            editingTransactionId = id;
            if (id) {
                transactionModalTitle.textContent = 'Edit Transaksi';
                const t = budgetTransactions.find(t => t.id === id);
                transactionTypeInput.value = t.type;
                transactionAmountInput.value = t.amount;
                transactionDescriptionInput.value = t.description;
                transactionDateInput.value = t.date;
                transactionCategoryInput.value = t.category || 'wajib';
            } else {
                transactionModalTitle.textContent = 'Tambah Transaksi';
                transactionForm.reset();
                transactionDateInput.value = formatDateToYYYYMMDD(new Date());
            }
            toggleCategoryVisibility();
            addEditTransactionModal.classList.remove('hidden');
            transactionAmountInput.focus();
        }
        
        function showExportBudgetModal() {
            const today = new Date();
            const firstDay = new Date(today.getFullYear(), today.getMonth(), 1);
            const lastDay = new Date(today.getFullYear(), today.getMonth() + 1, 0);
            exportStartDateInput.value = formatDateToYYYYMMDD(firstDay);
            exportEndDateInput.value = formatDateToYYYYMMDD(lastDay);
            exportBudgetModal.classList.remove('hidden');
        }
        
        function hideModals() {
            addEditTransactionModal.classList.add('hidden');
            exportBudgetModal.classList.add('hidden');
        }
        
        function toggleCategoryVisibility() {
            categoryContainer.style.display = transactionTypeInput.value === 'expense' ? 'block' : 'none';
        }

        function exportToXlsx() {
            const startDate = new Date(exportStartDateInput.value);
            const endDate = new Date(exportEndDateInput.value);
            endDate.setHours(23, 59, 59, 999);
            if (!exportStartDateInput.value || !exportEndDateInput.value || startDate > endDate) {
                showMessage('Rentang tanggal tidak valid.', 'error'); return;
            }
            const filtered = budgetTransactions.filter(t => {
                const tDate = new Date(t.date); return tDate >= startDate && tDate <= endDate;
            });
            if (filtered.length === 0) {
                showMessage('Tidak ada data untuk diekspor pada rentang ini.', 'error'); return;
            }
            const dataToExport = filtered.map(t => ({
                Tanggal: new Date(t.date).toLocaleDateString('id-ID'),
                Tipe: t.type === 'income' ? 'Pemasukan' : 'Pengeluaran',
                Jumlah: t.amount,
                Deskripsi: t.description,
                Kategori: t.type === 'expense' ? (t.category === 'wajib' ? 'Wajib' : 'Keinginan') : ''
            }));
            const ws = XLSX.utils.json_to_sheet(dataToExport);
            const wb = XLSX.utils.book_new();
            XLSX.utils.book_append_sheet(wb, ws, 'Laporan Anggaran');
            XLSX.writeFile(wb, `Laporan_Anggaran_${formatDateToYYYYMMDD(startDate)}_-_${formatDateToYYYYMMDD(endDate)}.xlsx`);
            hideModals(); showMessage('Data berhasil diekspor!', 'success');
        }

        // --- Event Listeners ---
        addTransactionButton.addEventListener('click', () => showAddEditTransactionModal());
        cancelTransactionButton.addEventListener('click', hideModals);
        transactionForm.addEventListener('submit', (e) => {
            e.preventDefault();
            const formData = new FormData(transactionForm); 
            saveTransaction({
                id: editingTransactionId,
                type: formData.get('transactionTypeInput'),
                amount: parseFloat(formData.get('transactionAmountInput')),
                description: formData.get('transactionDescriptionInput'),
                date: formData.get('transactionDateInput'),
                category: formData.get('transactionCategoryInput')
            });
        });
        
        transactionList.addEventListener('click', e => {
            if (e.target.classList.contains('edit-btn')) showAddEditTransactionModal(e.target.dataset.id);
            if (e.target.classList.contains('delete-btn')) {
                if (confirm(`Anda yakin ingin menghapus transaksi ini?`)) deleteTransaction(e.target.dataset.id);
            }
        });

        transactionTypeInput.addEventListener('change', toggleCategoryVisibility);
        transactionSearchInput.addEventListener('input', renderTransactionList);
        exportBudgetButton.addEventListener('click', showExportBudgetModal);
        cancelExportButton.addEventListener('click', hideModals);
        confirmExportButton.addEventListener('click', exportToXlsx);
        
        loadTransactions();

    </script>
</body>
</html>
